# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run dev
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

## Слой данных

### Интерфейсы 

#### Интерфейс IProduct
Этот интерфейс описывает данные о товаре, которые приходят с сервера. А именно: идентификатор, название, адрес изображения, категория, к которой относится товар, цена и описание.

`id: string'` - идентификатор товара. Индивидуальный номер товара, который приходит в виде строки.
`description: string` - описание товара приходит в виде строки.
`image: string` - адрес изображения товара приходит в виде строки.
`title: string` - название товара приходит в виде строки.
`category: string` - категория товара приходит в виде строки.
`price: number | null` - стоимость товара приходит в виде числа либо являются "бесценными", поэтому необходимо учитывать и пустое значение.

#### Интерфейс IBuyer
Этот интерфейс описывает данные о пользователе, которые заполняются пользователем в формах оформления заказа. А именно: способ оплаты, адрес, почта и номер телефона.

`payment: 'card' | 'cash'` - способ оплаты. Может быть либо наличными, либо картой.
`email: string` - адрес электронной почты записывается в виде строки.
`phone: string` - номер телефона записывается в виде строки.
`address: string` - адрес записывается в виде строки.

### Классы

#### Класс Catalog
Управляет списком товаров и данными каждого отдельного товара.

Конструктор класса не принимает параметров.

Поля класса:  
`productsList: IProduct[]` - список всех товаров.
`selectedProduct: IProduct | null` - выбранный товар.

Методы класса:  
`setItems(products: IProduct[]): void` - сохраняет список товаров.
`setSelectedItem(product: IProduct): void` - сохраняет данные выбранного товара.
`getItems(): IProduct[]` - возвращает список товаров.
`getItemById(id: string): IProduct | undefined` - возвращает товар с заданным идентификатором.
`getSelectedItem(): IProduct | null` - возвращает выбранный товар.

#### Класс Buyer
Хранит данные о пользователе и проверяет их валидность.

Конструктор класса не принимает параметров.

Поля класса:  
`payment: 'card' | 'cash' | null` - способ оплаты. Может быть либо наличными, либо картой.
`email: string` - адрес электронной почты, является строкой.
`phone: string` - номер телефона, является строкой.
`address: string` - адрес, является срокой.

Методы класса:  
`setPayment(payment: TPayment): void` - сохраняет способ оплаты.
`setEmail(payment: TPayment): void` - сохраняет адрес электронной почты.
`setPhone(payment: TPayment): void` - сохраняет номер телефона.
`setAddress(payment: TPayment): void` - сохраняет адрес.
`getData(): IBuyer` - возвращает данные о пользователе.
`clearData(): void` - удаляет данные о пользователе.
`validateData(): {isValid: boolean, error?: string}` - проверяет валидность данных о пользователе и возвращает объект с результатами проверки.

#### Класс Cart
Управляет товарами, которые пользователь добавил в корзину.

Конструктор класса не принимает параметров.

Поля класса:  
`cart: IProduct[]` - список товаров, добавленных в корзину.

Методы класса:  
`addItem(product: IProduct): void` - добавляет товар корзину.
`deleteItem(product: IProduct): void` - удаляет товар из корзины.
`getItems(): IProduct[]` - возвращает список товаров, которые находятся в корзине.
`getTotal(): number` - возвращает стоимость всех товаров в корзине.
`getCount(): number` - возвращает количество товаров в корзине.
`hasItem(id: string): boolean` - проверяет наличие товара в корзине.
`clear(): void` - удаляет все товары из корзины.

## Слой коммуникации

### Интерфейсы

#### Интерфейс IOrder
Этот интерфейс описывает, какие данные заполняются в процессе формирования заказа. А именно: способ оплаты, .

`payment: 'card' | 'cash'` - способ оплаты. Может быть либо картой, либо наличными.
`email: string` - адрес электронной почты записывается в виде строки.
`phone: string` - номер телефона записывается в виде строки.
`address: string` - адрес записывается в виде строки.
`items: string[]` - список товаров записывается в массива идентификаторов товаров.
`total: number` - итоговая сумма записывается в виде числа.

#### Интерфейс IOrderConfirmation
Этот интерфейс описывает, какие данные приходят в ответе сервера после оформления заказа. А именно: идентификатор заказа, сумма заказа, сообщение об ошибке(опционально).

`id: string` - идентификатор заказа приходит в виде строки.
`total: number` - сумма заказа приходит в виде числа.
`error?: string` - сообщение об ошибке записывается в виде строки, не является обязательным.

### Классы

#### Класс WebLarekApi
Отвечает за получение данных с сервера и отправку данных на сервер.

Так как класс отвечает за получение данных, конструктор принимает объект класса Api имеет вид:
`constructor(api: IApi)`

Поля класса:  
`api: IApi` - API.

Методы класса:
`getProducts(): Promise<IProduct[]>` - делает `GET`-запрос на сервер и возвращает список товаров в виде массива объектов.
`postOrder(order: IOrderRequest): Promise<IOrderResponse>` - делает `POST`-запрос на сервер и возвращает ответ об успехе или ошибке.

## Слой отображения

#### Класс Gallery>
Наследуется от класса Component - `class Gallery extends Component<HTMLElement[]>`
Отвечает за отображение списка карточек товаров.

Конструктор: 
`constructor(container: HTMLElement)` - ищет элемент, куда будет записываться список товаров.

Поля класса:
`catalogElement: HTMLElement` - обёртка списка карточек.

Методы класса:
`set catalog(items: HTMLElement[]): void` - задает карточки товаров, которые будут отображаться.

#### Класс Modal
Наследуется от класса Component - `class Modal extends Component<IModal>`
Отвечает за отображение модальных окон.

Конструктор: 
`constructor(container: HTMLElement)` - ищет контейнер для модального окна.

Поля класса:
`contentElement: HTMLElement` - обёртка контента модального окна.
`button: HTMLButtonElement` - кнопка для закрытия модального окна.

Методы класса:
`open(): void`, `close(): void`, `isOpen(): boolean` — методы управления показом модального окна (модификатор `modal_active`).  
`set content(template: HTMLElement)` - задает контент, отображаемый в модальном окне.

#### Класс StandartCard
Наследуется от класса Component - `class StandartCard<T> extends Component<T & Pick<IProduct, 'title' | 'price'>>`
Отвечает за отображение карточки товара. Является родительским для классов, отображающих карточки в разных состояниях.

Конструктор: 
`constructor(container: HTMLElement)` - ищет элемент, куда будет записываться информация о товаре.

Поля класса:
`titleElement: HTMLElement` - название товара.
`priceElement: HTMLElement` - стоимость товара.

Методы класса:
`set title(value: string): void` - задает название товара.
`set price(value: number | null): void` - задает стоимость товара.
`setImage(element: HTMLImageElement, url: string, title: string): void` - задает картинку товара.

##### Класс CardCatalog
Наследуется от класса StandartCard - `class CardCatalog extends StandartCard<TCardCatalog>`

Поля класса:
`imageElement: HTMLImageElement` - изображение  на карточке.
`categoryElement: HTMLElement` - категория товара на карточке.

Методы класса:
`set image(url: string): void` - задает картинку товара.
`set category(value: string): void` - задает категорию товара.

##### Класс CardPreview
Наследуется от класса StandartCard - `class CardPreview extends StandartCard<TCardPreview>`

Поля класса:
`imageElement: HTMLElement` - изображение карточки.
`categoryElement: HTMLElement` - категория товара на карточке.
`descriptionElement: HTMLElement` - описание товара.
`button: HTMLButtonElement` - кнопка добавления товара в корзину.

Методы класса:
`set image(url: string): void` - задает картинку товара.
`set category(value: string): void` - задает категорию товара.
`set description(value: string): void` - задает описание товара.
`set buttonState(state: 'add' | 'remove' | 'disabled'): void` - задает состояние кнопки: добавить в корзину, удалить из корзины или заблокирована.

##### Класс CardBasket
Наследуется от класса StandartCard - `class CardBasket extends StandartCard<ICardBasket>`

Поля класса:
`indexElement: HTMLElement` - интекс товара в корзине.
`button: HTMLButtonElement` - кнопка удаления товара из корзины.

Методы класса:
`set index(index: number): void` - задает порядковый номер товара в корзине.

#### Класс FormStandart
Наследуется от класса Component - `class FormStandart<T> extends Component<T & IFormStandart>`
Отвечает за отображение форм. Является родительским для классов, отображающих формы в разных состояниях.

Конструктор: 
`constructor(container: HTMLFormElementUI)` - ищет форму.

Поля класса:
`button: HTMLButtonElement` - кнопка подтверждения.
`errorElement: HTMLElement` - элемент для вывода ошибок.

Методы класса:
`set buttonState(isValid: boolean): void` - задает состояние кнопки.
`set error(err: string): void` - выводит ошибку.

##### Класс FormOrder
Наследуется от класса FormBaseUI - `class FormOrder extends FormStandart<IFormOrder>`

Поля класса:
`paymentElement: 'card' | 'cash' | null` - выбранный способ оплаты.
`paymentButtons: HTMLButtonElement[]` - кнопки выбора способа оплаты.
`addressElement: HTMLInputElement` - поле ввода адреса.

Методы класса:
`set payment(value: 'card' | 'cash'): void` - задает состояние кнопки.
`set address(value: string): void` - задает адрес.

##### Класс FormUserInfo
Наследуется от класса FormStandart - `class FormUserInfo extends FormStandart<IFormUserInfo>`

Поля класса:
`emailElement: HTMLInputElement` - поле ввода  электронной почты.
`phoneElement: HTMLInputElement` - поле ввода номера телефона.

Методы класса:
`set email(value: string): void` - задает адрес электронной почты.
`set phone(value: string): void` - задает номер телефона.

#### Класс HeaderBasket
Наследуется от класса Component - `class HeaderBasket extends Component<IHeaderBasket>`
Отвечает за отображение счетчика товаров в корзине и за кнопку, открывающую корзину.

Конструктор: 
`constructor(container: HTMLElement)` - ищет элемент, куда будет записываться счетчик.

Поля класса:
`counterElement: HTMLElement` - счетчик товаров в корзине.
`button: HTMLButtonElement` - кнопка для открытия корзины.

Методы класса:
`set counter(value: number): void` - изменяет отображение количества товаров в корзине.

#### Класс Basket
Наследуется от класса Component - `class Basket extends Component<IBasket>`. Отвечает за отображение корзины.

Конструктор: 
`constructor(content: HTMLElement)` - ищет элемент корзины.

Поля класса:
`listElement: HTMLUListElement` - элемент, куда будут выводиться добавленные в корзину товары.
`totalElement: HTMLElement` - элемент, куда будет выводиться итоговая сумма.
`button: HTMLButtonElement` - кномка оформления заказа.

Методы класса:
`set products(products: HTMLElement[]): void` - отрисовывает товары в корзине.
`set total(sum: number): void` - задает итоговую сумму.
`set buttonState(state: boolean)` - изменяет состояние кнопки оформления заказа.
`set message` - сообщает об отсутствии товаров в корзине.

#### Класс OrderSuccess
Наследуется от класса Component - `class OrderSuccess extends Component<IOrderSuccess> `.Отвечает за отображение сообщения об успешной покупке.

Конструктор: 
`constructor(content: HTMLElement)` - ищет элемент, куда будет записываться сумма покупки.

Поля класса:
`totalElement: HTMLElement` - сумма покупки.
`button: HTMLButtonElement` - кнопка подтверждения покупки.

Методы класса:
`set total(value: number): void` - задает сумму покупки для списания.

## Презентер

Презентер является центральным компонентом архитектуры MVP, который содержит основную бизнес-логику приложения и обеспечивает связь между слоями Model и View. В данном проекте презентер реализован в основном скрипте приложения `main.ts`.

## События
Все события генерируются через `EventEmitter`.

#### `products:changed`
Генерируется при изменении каталога товаров. Данные - `{ products: IProduct[] }` - обновленный список товаров. Уведомляет о изменении каталога.

#### `card:select`
Генерируется при клике на карточку товара в каталоге. `IProduct` - объект выбранного товара. Открывает модальное окно с деталями товара.

#### `product:selected`
Генерируется при выборе товара для просмотра. Данные - `{ data: IProduct }` - выбранный товар. Уведомляет о выборе товара.

#### `card:add`
Генерируется при нажатии кнопки "Добавить в корзину" в модальном окне товара. Не передает данных. Добавляет товар в корзину.

#### `card:remove`
Генерируется при нажатии кнопки удаления товара из корзины. Не передает данных. Удаляет товар из корзины.

#### `modal:close`
Генерируется при нажатии кнопки закрытия модального окна. Не передает данных. Закрывает модальное окно.

#### `basket:open`
Генерируется при нажатии на кнопку корзины в шапке. Не передает данных. Открывает модальное окно с содержимым корзины.

#### `order`
Генерируется при нажатии кнопки "Оформить заказ" в корзине. Не передает данных. Открывает модальное окно оформления заказа.

#### `cart:changed`
Генерируется при любом изменении содержимого корзины (добавление, удаление, очистка). Уведомляет о изменении состава корзины.


#### `order:payment`
Генерируется при выборе способа оплаты в форме заказа. Данные - `{ payment: 'card' | 'cash' }` - выбранный способ оплаты. Сохраняет выбранный способ оплаты.

#### `order:address`
Генерируется при вводе адреса в поле формы заказа. Данные - `{ address: string }` - введенный адрес. Сохраняет адрес доставки.

#### `order:next`
Генерируется при нажатии кнопки "Далее" в форме заказа. Не передает данных. Переходит ко второй форме оформления заказа.

#### `contacts:email`
Генерируется при вводе email в поле формы контактов. Данные - `{ email: string }` - введенный email. Сохраняет email покупателя.

#### `contacts:phone`
Генерируется при вводе телефона в поле формы контактов. Данные - `{ phone: string }` - введенный номер телефона. Сохраняет номер телефона покупателя.

#### `buyer:changed`
Генерируется при изменении любых данных покупателя (способ оплаты, email, телефон, адрес). Данные - `{ payment: TPayment | null, email: string, phone: string, address: string }` - все данные покупателя. Уведомляет о изменении данных покупателя.

#### `order:submit`
Генерируется при завершении оформления заказа. Не передает данных. Отправляет заказ на сервер и показывает результат.

